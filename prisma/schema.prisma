// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "./generated/lib"
}

datasource db {
  provider = "mysql"
}

model Users {
  ID  String  @id @default(uuid()) @db.Char(36)
  Username String @unique @db.VarChar(50)
  Names String @db.VarChar(200)
  Hash String @db.VarChar(250)
  Role String @db.VarChar(8) // GESTOR o VENDEDOR
  IsActive Boolean @default(true)
  CreatedAt DateTime @default(now()) @db.Timestamp(6)
  UpdatedAt DateTime @updatedAt @db.Timestamp(6)

  orders Orders[]
}

model Products {
  ID  String  @id @default(uuid()) @db.Char(36)
  Code String @unique @db.VarChar(100)
  Name String @db.VarChar(200)
  Description String @db.Text
  Price Decimal @db.Decimal(12,2)
  Measure String @db.VarChar(20) // KILO, LITRO, UNIDAD
  IsActive Boolean @default(true)
  CreatedAt DateTime @default(now()) @db.Timestamp(6)
  UpdatedAt DateTime @updatedAt @db.Timestamp(6)
  DeletedAt DateTime? @db.Timestamp(6)

  Discount Discounts?
  orderItems OrderItems[]
}

model Discounts {
  ID  String  @id @default(uuid()) @db.Char(36)
  ProductID String @db.Char(36) @unique
  Type String @db.VarChar(20) // PORCENTAJE, MONTO FIJO
  Value Decimal @db.Decimal(5,2)
  StartDate DateTime @db.DateTime(6)
  EndDate DateTime @db.DateTime(6)
  IsActive Boolean @default(true)
  CreatedAt DateTime @default(now()) @db.Timestamp(6)
  UpdatedAt DateTime @updatedAt @db.Timestamp(6)

  product Products @relation(fields: [ProductID], references: [ID], onDelete: Restrict)
}

model Orders {
  ID  String  @id @default(uuid()) @db.Char(36)
  UserID String @db.Char(36)
  CustomerName String? @db.VarChar(200)
  CustomerLastName String? @db.VarChar(200)
  CustomerDNI String? @db.VarChar(20)
  Total Decimal @db.Decimal(12,2)
  PaymentMethod String @db.VarChar(20) // CASH
  CreatedAt DateTime @default(now()) @db.Timestamp(6)
  UpdatedAt DateTime @updatedAt @db.Timestamp(6)

  user Users @relation(fields: [UserID], references: [ID], onDelete: Restrict)
  @@index([CreatedAt])
  orderItems OrderItems[]
}

model OrderItems {
  ID  String  @id @default(uuid()) @db.Char(36)
  OrderID String @db.Char(36)
  ProductID String @db.Char(36)
  UnitPrice Decimal @db.Decimal(12,2)
  Qty Decimal @db.Decimal(12,2)
  TotalDiscount Decimal @db.Decimal(12,2)
  SubTotal Decimal @db.Decimal(12,2)
  TotalItem Decimal @db.Decimal(12,2)
  CreatedAt DateTime @default(now()) @db.Timestamp(6)
  UpdatedAt DateTime @updatedAt @db.Timestamp(6)

  order Orders @relation(fields: [OrderID], references: [ID], onDelete: Restrict)
  product Products @relation(fields: [ProductID], references: [ID], onDelete: Restrict)
}